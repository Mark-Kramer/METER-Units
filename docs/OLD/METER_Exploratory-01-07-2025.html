<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Reproducible exploratory analysis: Mitigating multiplicity when mining data – BU METER</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">BU METER</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../METER_Sample_Size-SHORT-Quarto.html"> 
<span class="menu-text">Sample Size</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#rat-brains-position-and-profit-an-introduction-to-exploratory-analysis" id="toc-rat-brains-position-and-profit-an-introduction-to-exploratory-analysis" class="nav-link active" data-scroll-target="#rat-brains-position-and-profit-an-introduction-to-exploratory-analysis">*1 - Rat brains, position, and profit: an introduction to exploratory analysis</a></li>
  <li><a href="#extra-extra-rat-brains-crack-the-stock-market-code" id="toc-extra-extra-rat-brains-crack-the-stock-market-code" class="nav-link" data-scroll-target="#extra-extra-rat-brains-crack-the-stock-market-code">EXTRA! EXTRA! RAT BRAINS CRACK THE STOCK MARKET CODE!</a></li>
  <li><a href="#thats-quite-a-story" id="toc-thats-quite-a-story" class="nav-link" data-scroll-target="#thats-quite-a-story">That’s quite a story …</a></li>
  <li><a href="#visualization-the-first-step-in-exploration" id="toc-visualization-the-first-step-in-exploration" class="nav-link" data-scroll-target="#visualization-the-first-step-in-exploration">[2 - Visualization, the first step in exploration]</a></li>
  <li><a href="#profit-rat-brains-for-high-frequency-trading-in-the-nyse" id="toc-profit-rat-brains-for-high-frequency-trading-in-the-nyse" class="nav-link" data-scroll-target="#profit-rat-brains-for-high-frequency-trading-in-the-nyse">*3- Profit! Rat brains for high-frequency trading in the NYSE</a></li>
  <li><a href="#not-so-fast-finding-meaningful-relationships-after-youve-tested-everything." id="toc-not-so-fast-finding-meaningful-relationships-after-youve-tested-everything." class="nav-link" data-scroll-target="#not-so-fast-finding-meaningful-relationships-after-youve-tested-everything.">*4- Not so fast … finding meaningful relationships after you’ve tested everything.</a></li>
  <li><a href="#rat-brains-either-predict-everything-or-nothing" id="toc-rat-brains-either-predict-everything-or-nothing" class="nav-link" data-scroll-target="#rat-brains-either-predict-everything-or-nothing">*5- Rat brains either predict everything or nothing?</a></li>
  <li><a href="#fdr-a-less-conservative-approach-to-multiplicity." id="toc-fdr-a-less-conservative-approach-to-multiplicity." class="nav-link" data-scroll-target="#fdr-a-less-conservative-approach-to-multiplicity.">6- FDR: a less conservative approach to multiplicity.</a></li>
  <li><a href="#split-your-data-to-test-your-conclusions." id="toc-split-your-data-to-test-your-conclusions." class="nav-link" data-scroll-target="#split-your-data-to-test-your-conclusions.">7- Split your data to test your conclusions.</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Reproducible exploratory analysis: Mitigating multiplicity when mining data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Identifying meaningful patterns and relationships within noisy data is a fundamental component of neuroscience research; however, multiplicity — the practice of conducting multiple simultaneous comparisons - can result in spurious and misleading conclusions. In this unit, learners will understand how multiplicity occurs, its impacts, and strategies to address it.</p>
<div class="alert alert-block alert-danger">
<p><b>Alert:</b> If you’re running this on <b>Google Colab</b>, then uncomment and run the next two cells.</p>
</div>
<div id="07d1c4fa-2969-419e-8d60-1e9075cb3076" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># !git clone https://github.com/Mark-Kramer/METER-Units.git</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="8658c043-55e3-4ef9-83e2-078809684b7b" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import sys</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sys.path.insert(0,'/content/METER-Units')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="rat-brains-position-and-profit-an-introduction-to-exploratory-analysis" class="level2">
<h2 class="anchored" data-anchor-id="rat-brains-position-and-profit-an-introduction-to-exploratory-analysis">*1 - Rat brains, position, and profit: an introduction to exploratory analysis</h2>
<div id="8ae7402f-3399-4340-a306-0c557f42893d" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load modules</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> ListedColormap</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load custom functions</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> exploratory_functions <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="extra-extra-rat-brains-crack-the-stock-market-code" class="level2">
<h2 class="anchored" data-anchor-id="extra-extra-rat-brains-crack-the-stock-market-code">EXTRA! EXTRA! RAT BRAINS CRACK THE STOCK MARKET CODE!</h2>
<p>In a dazzling demonstration of rodent ingenuity—or perhaps sheer luck—<a href="https://improbable.com/airchives/paperair/volume12/v12i4/rats-12-4.pdf">researchers have harnessed the firing neurons of rat motor cortices to predict movements in the U.S. stock market</a>. That’s right, folks! A team from Michigan and Georgia linked rat brain activity to Wall Street ticker tapes, proving that whiskers may rival Wall Street wits. By monitoring the firing rates of 94 neurons across three rats, these scientists uncovered correlations between neural activity and the daily closing prices of stocks on NASDAQ, the NYSE, and the American Stock Exchange. The Coca-Cola stock price, for instance, danced in sync with the neurons like Fred and Ginger at the Ziegfeld Follies.</p>
<p>But wait, there’s more! The researchers didn’t stop at finding patterns — they dove headfirst into the trading floor with a predictive model based on neural firing rates. Rats’ neural spikes gave the orders: buy, sell, or hold. And the results? An impressive 43% increase in a simulated portfolio value, turning an initial $$$1,000 investment into a snappy $$$1,435 over just 20 trading days. Forget the contrarian strategies of hedge fund honchos—our furry friends seem to have cracked the code.</p>
<p>And here’s the kicker, folks: this isn’t just about making a buck. The findings suggest a mysterious connection between rat neural activity and human economic behavior. The researchers propose a grand theory linking the creatures of Earth to the ebbs and flows of societal urges, tying their work to theories like Gaia’s interconnected organism hypothesis. So, the next time someone says, “it’s a rat race out there,” remember—they might just be running the show!</p>
</section>
<section id="thats-quite-a-story" class="level2">
<h2 class="anchored" data-anchor-id="thats-quite-a-story">That’s quite a story …</h2>
<p>Using noisy data recorded from rodent brains, the authors found a relationship between neural activity and stock prices. At first glance, these results may seem consistent with well-established observations that neural activity encodes a rodent’s location in its world <a href="https://www.nature.com/articles/514153a">citation</a>. However, you might also be (reasonably) skeptical. How could neurla</p>
<div class="alert alert-block alert-info">
<p><em>Introduction</em>:</p>
<ul>
<li>Background studies suggest relationships between neural activity and phenomena in the world.</li>
<li>For example, action potentials (or “spikes”) occurring in a rodent’s brain indicate:
<ul>
<li>the rodent’s location in the world (<a href="https://www.nature.com/articles/514153a">citation</a>, Nobel Prize)</li>
<li>stock prices of companies on the NYSE (<a href="https://improbable.com/airchives/paperair/volume12/v12i4/rats-12-4.pdf">citation</a>, Annals of Improbable Research).</li>
</ul></li>
<li>In this unit, you’ll explore a large data set to search for these types of relationships.</li>
<li>You’ll be confronted with a <strong>challenge</strong>: how will you decide among many possible relationships which are meaningful?</li>
</ul>
</div>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> When exploring data, the number of relationships between the things you observe increases quickly with the number of observed items. To get a sense for this, consider the results in (<a href="https://improbable.com/airchives/paperair/volume12/v12i4/rats-12-4.pdf">citation</a>, Annals of Improbable Research). How many relationships were tested?</p>
<p><strong>A:</strong> Activity from 94 neurons was compared with activity from 4195 stocks. The total number of comparisons considered is 94*4195 = 381,745.</p>
<p><em>Interpretation</em>: That number can get very big with modern big data observations! How do you decide which of these comparisons are meaningful?</p>
</div>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> Consider <code>N</code> neurons and <code>M</code> signals. How many possible combinations of relationships exist between the neurons and signals?</p>
<p><strong>A:</strong> N*M</p>
<p><em>Interpretation</em>: That number can get very big with modern big data observations! How do you decide which of these comparisons are meaningful?</p>
</div>
</section>
<section id="visualization-the-first-step-in-exploration" class="level2">
<h2 class="anchored" data-anchor-id="visualization-the-first-step-in-exploration">[2 - Visualization, the first step in exploration]</h2>
<p>Motivated by <a href="https://www.nature.com/articles/514153a">previous</a> <a href="https://improbable.com/airchives/paperair/volume12/v12i4/rats-12-4.pdf">studies</a>, you receive data from a collaborator interested in understanding the relationship between neural spiking in the rodent brain, rodent position, and stock prices on the NYSE. The data consist of the following information:</p>
<ul>
<li><p><code>spikes</code> - the action potentials (or “spikes”) generated by 200 neurons,</p></li>
<li><p><code>signals</code> - the rodent position (one of the signals) and the price of 99 stocks.</p></li>
</ul>
<p>Both the <code>spikes</code> and <code>signals</code> are recorded simultaneously, every 10 ms for 0.5 s, resulting in a total of 500 time points.</p>
<p><strong>Wrinkle:</strong> For the <code>signals</code>, our collaborator isn’t sure which of the 100 signals correpsonds to the rodent position. This happens sometimes. We that 1 of the 100 signals is the rodent position, but not which one. That’s ok for now, in our exploratory analysis.</p>
<div id="33807648-6ab3-48ef-aa85-6f1ebc080206" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>spikes, signals, t <span class="op">=</span> load_data()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’re interested in understanding the relationship (if any) between <code>spikes</code> and <code>signals</code>.</p>
<p>Let’s start by investigating the structure of the data.</p>
<div id="e581a977-88b6-42f8-9dcc-302e78b5cf4c" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(spikes.shape)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(signals.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Both <code>spikes</code> and <code>signals</code> consist of 500 time points (the number of rows). We collect data from 200 neurons and 100 signals (the number of columns).</p>
<p>You might think of these variables as rectangles (or matrices), where each row indicates a time point, and each column indicates a neuron or signal:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="IMG_Exploratory/simple_boxes_neuron_and_signals.jpg" class="img-fluid figure-img"></p>
<figcaption>title</figcaption>
</figure>
</div>
<p>Let’s plot the data from one neuron in <code>spikes</code>:</p>
<div id="10ec16f4-2003-421e-9077-0dabde8cc17f" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the spiking from an example neuron.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">2</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>plot_spike_train(t, spikes[:,<span class="dv">0</span>])  <span class="co"># Plot the first spike train.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> How do these data represent “spikes”?</p>
<p><strong>A:</strong> In this signal, the value 1 represents a spike occurs at time ‘t’. The value 0 indicates that no spike occurs at time ‘t’. In the figure, we use a black circle to indicate the times of spikes.</p>
</div>
<p>Let’s also plot the data from one signal in <code>signals</code>:</p>
<div id="5783096b-96d5-4283-8f5b-d26e40cf1681" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the spiking from an example neuron.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">2</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>plt.plot(t, signals[:,<span class="dv">0</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> What features do you notice in the signal?</p>
<p><strong>A:</strong> It’s “wiggly” and maybe there are rhythmic oscillations, but it’s hard to tell. It’s “noisy”.</p>
</div>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> Compare the plots of example spiking and an example signal. Are they related?</p>
<p><strong>A:</strong> It’s very difficult to tell what relationship - if any - exists between the signals.</p>
<p><em>Interpretation</em>: Visual inspection is not especially useful in this example.</p>
</div>
<p>To more directly compare the <code>spikes</code> and <code>signals</code>, let’s plot one atop the other:</p>
<div id="36e8774b-3148-408c-ba01-d39181c11021" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">2</span>))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>plt.plot(t, signals[:,<span class="dv">0</span>])<span class="op">;</span>        <span class="co"># Plot the first signal.</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>plot_spike_train(t, spikes[:,<span class="dv">0</span>])  <span class="co"># Plot the first spike train.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> Compare the spikes (black dots) and signal (blue trace) in the plot above. Are they related?</p>
<p><strong>A:</strong> It’s very difficult to tell what relationship - if any - exists between the signals.</p>
<p><em>Interpretation</em>: Visual inspection is not especially useful in this example.</p>
</div>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> We’ve used visual inspection to compare the spike train from one neuron (the first column of <code>spikes</code>) and one signal (the first column of <code>signals</code>). We didn’t see an obvious relationship. However, there are many more relationships to compare. Repeat this analysis to compare each spike train (columns 1 to 200 of <code>spikes</code>) with each signal (columns 1 to 100 of <code>signals</code>). Do you observe any relationships.</p>
<p><strong>A:</strong> Wait! That’s 100*200 = 20,000 plots to visualize …</p>
</div>
<div class="alert alert-block alert-danger">
<p><b>Alert: Wait, we can’t use visualization alone!</b></p>
<p></p>
<ul>
<li><p>There are 200 neurons and 100 signals, resulting in 20,000 pairs to consider.</p></li>
<li><p>We can’t possibly visualize all of those.</p></li>
<li><p>Instead, we need to perform statistical tests.</p></li>
</ul>
</div>
</section>
<section id="profit-rat-brains-for-high-frequency-trading-in-the-nyse" class="level2">
<h2 class="anchored" data-anchor-id="profit-rat-brains-for-high-frequency-trading-in-the-nyse">*3- Profit! Rat brains for high-frequency trading in the NYSE</h2>
<p>Let’s now investigate the pairwise associations between the spiking of 200 neurons in the rat brain, the rat position, and 99 stock prices.</p>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> We have 200 neurons and 100 signals. How many possible combinations of relationships exist between the neurons and signals?</p>
<p><strong>A:</strong> 200*100 = 20,000</p>
<p><em>Interpretation</em>: That’s a large number! I wonder if we’ll find something interesting in there …</p>
</div>
<p>To compare the <code>spikes</code> and <code>signals</code>, we perform a statisitcal test of the association between each pair of data. The details of the test are not important. What is important is that each test produces a p-value, and small p-values indicate statistically significant associations (<strong>link to Unit:“Putting the p-value in Context”</strong>).</p>
<p>Let’s compute those p-values now. This step is slow, because there are many p-values to compute!</p>
<div id="7e3923ab-7914-4cab-b56b-53373e2ca723" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> compute_p_values(spikes, signals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For each neuron-signal pair, we estimate the association with an associated p-value. Let’s visualize those p-values.</p>
<div id="1fbee484-9a1a-4c45-8ab0-9d8850b8ce09" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(p)<span class="op">;</span> plt.colorbar()<span class="op">;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Neuron number'</span>)<span class="op">;</span> plt.ylabel(<span class="st">'Signal number'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> What do you observe? Can you find the meaningful relationships between neurons and signals, if any?</p>
<p><strong>A:</strong> We’re looking for small values (the darkest blue) in the image. It’s very difficult to see the meaningful relationships. The image is noisy.</p>
</div>
<p>Let’s look for the “most significant” association - that with the smallest p-value - and plot the spikes and signal for this association.</p>
<div id="6d9d51c5-4008-4607-b08f-493f0bc484bf" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>min_index_flat <span class="op">=</span> np.argmin(p)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>min_index <span class="op">=</span> np.unravel_index(min_index_flat, p.shape)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(min_index)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">2</span>))               <span class="co"># For the association with the smallest p-value,</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>plt.plot(t,        signals[:,min_index[<span class="dv">0</span>]])<span class="op">;</span>        <span class="co"># ... plot the signal,</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>plot_spike_train(t, spikes[:,min_index[<span class="dv">1</span>]])  <span class="co"># ... plot the spike train.</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">100</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To isolate meaningful relationships, let’s find all associations in which p&lt;0.05, the standard threshold for signficance applied in practice (<strong>link to Unit:“Putting the p-value in Context”</strong>).</p>
<div id="5b5c6ba9-a696-4e96-bd1d-57d6dfd1b53e" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">sum</span>(p <span class="op">&lt;</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> Interpert this result. What do you conclude about the data?</p>
<p><strong>A:</strong> Of the 20,000 possible associations between spikes and signals, we detect 1043 associations with p&lt;0.05.</p>
<p><em>Interpretation</em>: Rat brains are associated with stock prices! Let’s develop a new strategy for profitable high-frequency stock trading using rat brain neuron spiking.</p>
</div>
<div class="alert alert-block alert-info">
<p><em>Reflection</em>:</p>
<ul>
<li>Hmm, there are a lot of significant relationships - this is so easy! Why isn’t this used more often? Something must not be exactly correct…</li>
</ul>
</div>
<div class="alert alert-block alert-danger">
<p><b>Alert: Wait, this doesn’t make sense!</b></p>
<p></p>
<ul>
<li><p>How can the spike timing in a rat brain relate to stock market prices?</p></li>
<li><p>We’ve identified all associations with p&lt;0.05 … Is that the right choice?</p></li>
</ul>
</div>
<div class="alert alert-block alert-info">
<p><em>Moment of tension</em>:</p>
<ul>
<li>Hook the learner - “something isn’t right and I want to know why.”</li>
</ul>
</div>
</section>
<section id="not-so-fast-finding-meaningful-relationships-after-youve-tested-everything." class="level2">
<h2 class="anchored" data-anchor-id="not-so-fast-finding-meaningful-relationships-after-youve-tested-everything.">*4- Not so fast … finding meaningful relationships after you’ve tested everything.</h2>
<p>In Mini 3, we assessed associations between 200 neurons and 100 signals.</p>
<p>This exploration led to many (20,000) statistical tests.</p>
<p>We now need to <strong>correct for multiplicity</strong>.</p>
<p>When conducting multiple hypothesis tests, increased error rates occur because each test has a chance of incorrectly rejecting the null hypothesis (a false positive). This error, typically called the Type I error, is the probability of a single test falsely claiming a statistically significant effect.</p>
<p>As more tests are performed, the cumulative probability of committing at least one Type I error across all these tests increases, leading to an overall higher error rate for the set of tests than for any individual test. This phenomenon is often referred to as the “multiple comparisons problem” or “multiplicity.”</p>
<p><strong>To mitigate multiplicity when mining data</strong>, we must account for increased error rates due to conducting multiple hypothesis tests on the same dataset.</p>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> In our initial analysis, we chose a Type I error rate (<span class="math inline">\(\alpha\)</span>) of 0.05. So, each test has a probability of 0.05 of falsely claiming a statistically significant effect.</p>
<p>We performed 20,000 total tests. How many false statistically significant effects do we expect?</p>
<p><strong>A:</strong> 20,000 * 0.05 = 1000</p>
<p><em>Interpretation</em>: Because we conducted so many tests (20,000), and selected all associations with p&lt;0.05, we expect 1000 false positives. In Unit 3, we found 1043 associations with p&lt;0.05. We conclude that most of these associatiosn are false positives!</p>
</div>
<p>To correct for multiplicity, let’s apply a popular procedure: <strong>the Bonferroni correction</strong>.</p>
<p>The Bonferroni correction reduces the Type I error rate by dividing the desired overall significance level (<span class="math inline">\(\alpha\)</span>) by the number of tests performed.</p>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> Compute the Bonferroni correction using our desired overall significance level (<span class="math inline">\(\alpha=0.05\)</span>) and the number of tests performed.</p>
<p><strong>A:</strong> 0.05 / 20000 = 0.0000025</p>
<p><em>Interpretation</em>: Using the Bonferroni correction, we now declare associations as significant if p &lt; 0.0000025.</p>
</div>
<p>Let’s apply the Bonferroni correction to our matrix of p-values (<code>p</code>) and determine the number of significant associations, after correcting for multiplicity.</p>
<div id="b49e0d46-2484-45a2-850c-8db55fd577c9" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">sum</span>(p <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">/</span><span class="dv">20000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> Interpert this result. What do you conclude about the data?</p>
<p><strong>A:</strong> Of the 20,000 possible associations between spikes and signals, we detect 0 associations with p&lt;0.05 after applying the Bonferroni correction.</p>
<p><em>Interpretation</em>: Rat brains not associated with stock prices or positions.</p>
</div>
<div class="alert alert-block alert-danger">
<p><b>Alert: Wait, this doesn’t make sense!</b></p>
<p></p>
<ul>
<li><p>Much work (including <a href="https://www.nature.com/articles/514153a">Noble Prize work</a>) has established a relationship between rat neuron spiking and rodent position.</p></li>
<li><p>We’ve identified all associations with p&lt;0.05 after Bonferroni correction … Is that the right choice?</p></li>
</ul>
</div>
<div class="alert alert-block alert-info">
<p><em>Extension / simulation (DRAFT):</em></p>
<ul>
<li>Flip 5 coins. Are you likely to get all heads?
<ul>
<li>No.&nbsp;That’s unlikely when you do it once.</li>
</ul></li>
<li>Now, ask 1000 people to repeat this 5 coin flip process. Do you think <em>someone</em> will get all heads?
<ul>
<li>Yes. By chance, someone might flip 5 coins and get all heads.</li>
<li>The goal of accounting for multiplcity is to control for these by chance occurrences.</li>
</ul></li>
</ul>
</div>
</section>
<section id="rat-brains-either-predict-everything-or-nothing" class="level2">
<h2 class="anchored" data-anchor-id="rat-brains-either-predict-everything-or-nothing">*5- Rat brains either predict everything or nothing?</h2>
<p>We’ve applied two strategies to confront multiplicity in exploratory analysis</p>
<ul>
<li>Do nothing (Mini 3)</li>
<li>Bonferroni correction (Mini 4)</li>
</ul>
<p>The two strategies give completely different results. Either neurons in the rat brain spike with many associations to observed signals (Mini 3) or no associations (Mini 4). And, neither result makes sense when compared to the <a href="https://www.nature.com/articles/514153a">existing</a> <a href="https://improbable.com/airchives/paperair/volume12/v12i4/rats-12-4.pdf">literature</a>. <strong>So, now what?</strong></p>
<p>Many strategies exist to correct for multiplicity. There’s no single “right” approach.</p>
<ul>
<li><p>Our first approach (do nothing) is too lenient - we allow two many false positives. And, in doing so, we draw a ridiculous scientific conclusion: action potentials in the rat brain predict prices on the stock market.</p></li>
<li><p>Our second approach (Bonferroni correction) is too strict - we allow too few false positives. And, in doing so, we find no evidence for a well-established scientific conclusion: action potentials in the rat brain encode position.</p></li>
</ul>
<p>Perhaps we can find an intermediate approach, that allows neither too many nor too few false positives …</p>
<p>In what follows, you can explore alternatives to our choices above, and see how these choices impact your results.</p>
<p><strong>Choose your own adventure!</strong></p>
<ul>
<li>False Discovery Rate or FDR (Mini 6)</li>
<li>Split the data (Mini 7)</li>
</ul>
</section>
<section id="fdr-a-less-conservative-approach-to-multiplicity." class="level2">
<h2 class="anchored" data-anchor-id="fdr-a-less-conservative-approach-to-multiplicity.">6- FDR: a less conservative approach to multiplicity.</h2>
<p>You’ve chosen one approach to mitigate the impact of performing multiple statistical tests: calculate the False Discovery Rate (FDR).</p>
<p>To do so, we’ll use the <a href="https://rss.onlinelibrary.wiley.com/doi/abs/10.1111/j.2517-6161.1995.tb02031.x">Benjamini-Hochberg procedure</a>, implemented in these steps:</p>
<ol type="1">
<li><p><strong>Rank your p-values</strong> from the smallest to the largest. Call these ranked p-values <span class="math inline">\(p_R\)</span>.</p></li>
<li><p><strong>Assign each p-value a rank</strong>, <span class="math inline">\(R\)</span>, where the smallest p-value has rank 1, the next smallest has rank 2, and so on.</p></li>
<li><p><strong>Calculate the critical value</strong> for each p-value using the formula:</p></li>
</ol>
<p><span class="math inline">\(CriticalValue =(R/N) \alpha\)</span></p>
<p>where <span class="math inline">\(N\)</span> is the total number of tests, and <span class="math inline">\(\alpha\)</span> is the desired overall significance level (typically 0.05 for 5% FDR).</p>
<ol start="4" type="1">
<li><strong>Compare each p-value to its corresponding critical value.</strong> The largest rank, <span class="math inline">\(R\)</span>, for which <span class="math inline">\(p_R \leq Critical Value\)</span> is considered significant, and all p-values with ranks less than or equal to this <span class="math inline">\(R\)</span> are considered significant.</li>
</ol>
<p>To build some intuition for these steps, let’s start with a simple example.</p>
<p>Consider an experiment in which you perform 5 hypothesis tests and collect 5 p-values:</p>
<p>p-value: [0.1, 0.12, 0.001, 0.03, 0.045]</p>
<p>We conducted 5 tests, and decide to correct for multiplicity.</p>
<p>Let’s use the p-values to perform each step of the Benjamini-Hochberg procedure.</p>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> Perform Step 1. <strong>Rank the p-values</strong>.</p>
<p><strong>A:</strong> [0.001, 0.03, 0.045, 0.1, 0.12]</p>
</div>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> Perform Step 2. <strong>Assign each p-value a rank</strong>.</p>
<p><strong>A:</strong> p-value, Rank</p>
<p>0.001, 1</p>
<p>0.03, 2</p>
<p>0.045, 3</p>
<p>0.1, 4</p>
<p>0.12, 5</p>
</div>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> Perform Step 3. <strong>Calculate the critical value</strong>.</p>
<p><strong>A:</strong> The critical value for each p-value is (Rank / Total number of tests) * Alpha level. Let’s use an alpha level of 0.05, the critical values for each rank would be:</p>
<p>Rank, Critical values</p>
<p>1, (1/5)*0.05 = 0.01</p>
<p>2, (2/5)*0.05 = 0.02</p>
<p>3, (3/5)*0.05 = 0.03</p>
<p>4, (4/5)*0.05 = 0.04</p>
<p>5, (5/5)*0.05 = 0.05</p>
</div>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> Perform Step 4. <strong>Compare each p-value to its corresponding critical value.</strong></p>
<p><strong>A:</strong> Let’s do this for each p-value, starting from the smallest p-value:</p>
<p>p-value &lt; or &gt; Critical values</p>
<p>0.001 vs (1/5)*0.05 = 0.01 … &lt;, significant</p>
<p>0.03 vs (2/5)*0.05 = 0.02 … &lt;, significant</p>
<p>0.045 vs (3/5)*0.05 = 0.03 … &gt;, not significant</p>
<p>0.1 vs (4/5)*0.05 = 0.04 … &gt;, not significant</p>
<p>0.12 vs (5/5)*0.05 = 0.05 … &gt;, not significant</p>
<p>Thus, p-values of 0.001 and 0.03 are considered significant under an FDR threshold of 5%. The p-values of 0.045, 0.1, 0.12 do not meet the significance threshold in this analysis.</p>
</div>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> In this illustrative example, we found two p-values are considered significant using the FDR procedure. What would you find if you instead used a Bonferroni correction?</p>
<p><strong>A:</strong> For the Bonferroni correction, we use the threshold 0.05/5 = 0.01 for each comparison:</p>
<p>p-value &lt; or &gt; Critical values</p>
<p>0.001 vs (1/5)*0.05 = 0.01 … &lt;, significant</p>
<p>0.03 vs (1/5)*0.05 = 0.01 … &gt;, not significant</p>
<p>0.045 vs (1/5)*0.05 = 0.01 … &gt;, not significant</p>
<p>0.1 vs (1/5)*0.05 = 0.01 … &gt;, not significant</p>
<p>0.12 vs (1/5)*0.05 = 0.01 … &gt;, not significant</p>
<p>We now find that only one p-values (0.001) is considered significant under a Bonferroni correction.</p>
</div>
<p>Now, having built some intuition for computing the FDR using the Benjamini-Hochberg procedure, let’s apply it to our data of interest.</p>
<div id="5b69b131-76b4-4e45-a470-53645b08535a" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>p_values_signficant_after_FDR <span class="op">=</span> fdr(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function <code>fdr</code> returns whether each p-value in <code>p</code> remains signficant after correcting for multiplicity using FDR.</p>
<p>Let’s display the p-values that remain significant after correcting for multiplicity using FDR:</p>
<div id="a6df5236-c13a-4208-b360-bc55fbced814" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> ListedColormap([<span class="st">'white'</span>, <span class="st">'red'</span>])</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>plt.imshow(p_values_signficant_after_FDR, cmap<span class="op">=</span>cmap)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Neuron number'</span>)<span class="op">;</span> plt.ylabel(<span class="st">'Signal number'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="alert alert-block alert-success">
<p><strong>Q:</strong> Examine the figure above. Do you see any red dots, indicating significant relationships between neurons and signals after correcting for multiplicity using FDR?</p>
<p><strong>A:</strong> There are two red dots, between:</p>
<p>“Signal 0” and “Neuron 0” – i.e., the first signal and first neuron.</p>
<p>“Signal 0” and “Neuron 24” – i.e., the first signal and 25th neuron.</p>
<p><em>Interpretation</em>: After correcting for multiplicity, two neurons in the rat brain are associated with the same signal (“Signal 0”). We return to our collaborators, and they confirm that “Signal 0” corresponds to the rodent’s position.</p>
</div>
<div class="alert alert-block alert-info">
<p><em>Relief</em></p>
<ul>
<li>We’ve corrected for multiple comparisons and find a result that makes sense. These results are consistent with the existing theory that neuron’s in the brain encode rodent position.</li>
</ul>
</div>
</section>
<section id="split-your-data-to-test-your-conclusions." class="level2">
<h2 class="anchored" data-anchor-id="split-your-data-to-test-your-conclusions.">7- Split your data to test your conclusions.</h2>
<p>(Pending)</p>
<p>(Use first half of data, in time)</p>
<div id="db00d1b5-562b-4560-8ba9-8ae1a45c4e90" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> np.shape(spikes)[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>p_split <span class="op">=</span> compute_p_values(spikes[:,<span class="dv">0</span>:<span class="bu">int</span>(T<span class="op">/</span><span class="dv">2</span>)<span class="op">-</span><span class="dv">1</span>], signals[:,<span class="dv">0</span>:<span class="bu">int</span>(T<span class="op">/</span><span class="dv">2</span>)<span class="op">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(Find candidate significant associations)</p>
<div id="e7611a7f-6a39-46b5-91d1-ecc5bd06c17c" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>candidate_significant_pairs <span class="op">=</span> (p_split<span class="op">&lt;</span><span class="fl">0.05</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">sum</span>(candidate_significant_pairs.flatten()))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>[i_signals,i_spikes] <span class="op">=</span> np.where(candidate_significant_pairs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(Test these predicted associations in the second half of data)</p>
<div id="c2d65bc1-7ca9-4485-b63e-cb854edd5e98" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>p_test <span class="op">=</span> np.zeros(np.shape(i_signals))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, element <span class="kw">in</span> <span class="bu">enumerate</span>(i_signals):</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> signals[<span class="bu">int</span>(T<span class="op">/</span><span class="dv">2</span>):, i_signals[index]]       <span class="co"># Predictor variable</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> spikes[<span class="bu">int</span>(T<span class="op">/</span><span class="dv">2</span>):, i_spikes[index]]        <span class="co"># Response variable</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> sm.add_constant(X)  <span class="co"># Adding a constant column for the intercept</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    glm_model <span class="op">=</span> sm.GLM(y, X, family<span class="op">=</span>sm.families.Poisson())</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    glm_results <span class="op">=</span> glm_model.fit()</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    p_test[index] <span class="op">=</span> glm_results.pvalues[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(Identify significant associations)</p>
<div id="07ee72b6-8928-43e7-9f87-75426fd1c4a2" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>i0 <span class="op">=</span> np.where(p_test<span class="op">&lt;</span><span class="fl">0.05</span><span class="op">/</span>np.size(i_signals))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Signal'</span>, i_signals[i0], <span class="st">', Spike'</span>, i_spikes[i0])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>